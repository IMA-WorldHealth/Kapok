<!-- TODO Write templates in project standardised templating -->
<!-- TODO Remove all hardcoded account_type values -->
<head>
  
  <!-- Include font files - wkhtmltopdf versions worked with in the past have
  <!-- not always worked well without an absolute path -->
  <style>
    @font-face { 
      font-family : 'Tinos'; 
      src: url('{{=it.path}}/templates/fonts/Tinos-Regular.ttf') format('truetype');
    }
    @font-face { 
      font-family : 'Tinos'; 
      src: url('{{=it.path}}/templates/fonts/Tinos-Bold.ttf') format('truetype');
    }
    @font-face { 
      font-family : 'Tinos'; 
      src: url('{{=it.path}}/templates/fonts/Tinos-Italic.ttf') format('truetype');
    }
  </style>

  <link rel="stylesheet" href="{{=it.path}}/templates/style/normalize.css">
  <link rel="stylesheet" href="{{=it.path}}/templates/style/documents.css">
</head>

<body>
    
  <section id="letterhead"></section>

  <section id="title" class="center" style="margin-bottom : 40px;">
     
      /* TODO Drive from DB */
      /* Enterprise Name */
      <h1>IMCK Hopital Bon Berger</h1>
      
      /* Report Heading */
      <h1 id="heading">{{=it.heading}}</h1>
      {{? it.subheading }}
      <h2>{{=it.subheading}}</h2>
      {{?}}

      /* Report details */
      <h3>
        {{=it.fiscalDefinition.fiscal_year_txt}} - 
        {{=it.fiscalDefinition.dates.start}} 
        to 
        {{=it.fiscalDefinition.dates.end}}
      </h3>
  </section>
 
  <section>
  <!--span class="groupTitle">Insitution Income</span-->

    <table>
      <thead>
        <tr>
          <th></th>
          
          <!-- Repeat through column configuration --> 
          <th>{{=it.fiscalDefinition.fiscal_year_txt}}</th>

          {{? it.comparingYears }}
          <th>{{=it.compareDefinition.fiscal_year_txt}}</th>
          <th>Variance</th>
          <th>(%)</th>
          {{?}}
        </tr>
      </thead>
      
      <tbody>

          <!-- TODO Use a partial definition here -->

          {{ function displayAccounts(accounts, compareAccounts) { 
               accounts.forEach(function (line, index) { }}
        
        <tr>
          
          <td 
            style="padding-left: {{=line.depth * 20}}px;"
            class=" {{? line.account_type_id === it.TITLE_ACCOUNT_ID}}rowTitle{{?}}">
            {{? line.account_type_id === it.TITLE_ACCOUNT_ID}}{{=line.account_number}}{{?}}
            {{=line.account_txt}}
          </td>

          /* <{{? line.account_type_id !== it.TITLE_ACCOUNT_ID}}> */

          <td style="text-align : right;">{{=line.balance || 0}}</td>
         
          {{? it.comparingYears }}
          {{ var compareBalance = compareAccounts[index].balance; }}
          {{ var compareVariance = (Math.abs(Math.abs(compareBalance - line.balance) / Math.abs(compareBalance)) * 100) || 0; }}
          {{ var displayVariance = isFinite(compareVariance) ? compareVariance : 100; }}

          <td style="text-align : right; padding-left : 5px;">{{=compareBalance || 0}}</td>
          <td style="text-align : right; padding-left : 5px;">{{=compareBalance - line.balance}}</td>
          <td style="text-align : right; padding-left : 5px;">{{=displayVariance}}%</td>
          {{?}}

          /* {{?}} */

        </tr> 
 
      {{ }); }}
      {{ } }} 

      {{ displayAccounts(it.fiscal.incomeData, it.compare.incomeData); }}
      </tbody>
  
      <tbody>
        {{ displayAccounts(it.fiscal.expenseData, it.compare.expenseData); }}
      </tbody>
    </table>
  </section>
</body>

<!-- TODO Write templates in project standardised templating -->
<!-- TODO Remove all hardcoded account_type values -->
<head>
  
  <!-- Include font files - wkhtmltopdf versions worked with in the past have
  <!-- not always worked well without an absolute path -->
  <style>
    @font-face { 
      font-family : 'Tinos'; 
      src: url('{{=it.path}}/templates/fonts/Tinos-Regular.ttf') format('truetype');
    }
    @font-face { 
      font-family : 'Tinos'; 
      src: url('{{=it.path}}/templates/fonts/Tinos-Bold.ttf') format('truetype');
    }
    @font-face { 
      font-family : 'Tinos'; 
      src: url('{{=it.path}}/templates/fonts/Tinos-Italic.ttf') format('truetype');
    }
  </style>

  <link rel="stylesheet" href="{{=it.path}}/templates/style/normalize.css">
  <link rel="stylesheet" href="{{=it.path}}/templates/style/documents.css">

</head>

<body>
    
  <section id="letterhead"></section>

  <section id="title" class="center" style="margin-bottom : 40px;">
      <h5>IMCK Hopital Bon Berger</h5>
      <h5>{{=it.heading}}</h5>
  
      {{? it.subheading }}
      <h6>{{=it.subheading}}</h6>
      {{?}}

  </section>
 
  <section>
  <!--span class="groupTitle">Insitution Income</span-->

    <table class="income">
      <thead>
        <tr style="border-bottom : 1px solid grey">
          <td colspan="2"></td>
          
          <!-- Repeat through column configuration --> 
          <td style="text-align : center; padding-right : 10px;">{{=it.fiscalDefinition.fiscal_year_txt}}</td>

          {{? it.comparingYears }}
          <td style="text-align : center; padding-right : 10px;">{{=it.compareDefinition.fiscal_year_txt}}</td>
          <td style="text-align : center; padding-right : 10px;">Variance</td>
          <td style="text-align : center;">(%)</td>
          {{?}}
        </tr>
      </thead>
      
      <tbody>

          <!-- TODO Use a partial definition here -->

          {{ function displayAccounts(accounts, compareAccounts) { 
               accounts.forEach(function (line, index) { }}

        <tr class="totalRight {{? line.account_type_id === it.TITLE_ACCOUNT_ID}}underline{{?}}">
          
          <td style="{{? line.account_type_id === it.TITLE_ACCOUNT_ID}}font-weight : bold;{{?}}">
            {{? it.displayAccountNumber}}
            {{=line.account_number}}
            {{?}}
          </td>
          
          <td {{? line.account_type_id === it.TITLE_ACCOUNT_ID}}colspan="8"{{?}} style="text-align : left; padding-left: {{=line.depth * 20}}px; {{? line.account_type_id === it.TITLE_ACCOUNT_ID}}font-weight : bold;{{?}}">{{=line.account_number}} {{=line.account_txt}}</td>

          {{? line.account_type_id !== it.TITLE_ACCOUNT_ID}}
         
          <td style="text-align : right;">{{=line.balance || 0}}</td>
         
          {{? it.comparingYears }}
          {{ var compareBalance = compareAccounts[index].balance; }}
          {{ var compareVariance = (Math.abs(Math.abs(compareBalance - line.balance) / Math.abs(compareBalance)) * 100) || 0; }}
          {{ var displayVariance = isFinite(compareVariance) ? compareVariance : 100; }}

          <td style="text-align : right; padding-left : 5px;">{{=compareBalance || 0}}</td>
          <td style="text-align : right; padding-left : 5px;">{{=compareBalance - line.balance}}</td>
          <td style="text-align : right; padding-left : 5px;">{{=displayVariance}}%</td>
          {{?}}

          {{?}}

        </tr> 
 
      {{ }); }}
      {{ } }} 

      {{ displayAccounts(it.fiscal.incomeData, it.compare.incomeData); }}
      </tbody>
  
      <tbody>
        {{ displayAccounts(it.fiscal.expenseData, it.compare.expenseData); }}
      </tbody>
    </table>
  </section>
</body>
